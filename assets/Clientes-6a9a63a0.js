import{j as o,F as A,a as l,U as B,_ as L,$ as N,a1 as _,P as S,W as J,aG as X,aH as Y,a0 as ee,aI as oe,Q as te,aJ as ie,ab as ae,ay as U,aB as re}from"./@mui-94e45ada.js";import{S as ne,B as se}from"./Breadcrumb-c4cf427b.js";import{M as le}from"./material-react-table-1f8ebe78.js";import{r as m}from"./react-19ede8c0.js";import{A as ce,S as me}from"./AuditIconButton-d761f0b1.js";import{a as x,P as I,l as de}from"./localization-3d90e8d6.js";import{A as E,M as T,g as d,a as pe}from"./index-a032e14e.js";import{M as ue,a as ge,b as he,c as fe,D as Ce}from"./materialReactTableUtils-e433a167.js";import{n as G,s as v,a as y,b as R,c as Se}from"./swal-6db6c20f.js";import{C as De,c as be,a as we,b as Ae,d as ye,e as ze,f as xe,g as Ie,h as Ee,i as Te,j as ve}from"./ClienteRegistroDialog-de7d56aa.js";import{g as M,G as F}from"./graphql-request-396d023b.js";import{S as Re,a as Me}from"./SimpleMenu-fe44c236.js";import{o as q}from"./@hookform-4c1cadd7.js";import{u as V}from"./react-hook-form-f9fec52a.js";import{e as Fe}from"./@tanstack-464f39f1.js";import"./react-is-e5978b8b.js";import"./@emotion-01c0502c.js";import"./hoist-non-react-statics-6e7e3bdb.js";import"./@babel-41a3dc83.js";import"./stylis-79144faa.js";import"./react-transition-group-07c33d75.js";import"./react-dom-308b05ff.js";import"./scheduler-765c72db.js";import"./@popperjs-f3391c26.js";import"./jss-4560bbb1.js";import"./is-in-browser-9e40da8a.js";import"./jss-plugin-rule-value-function-275843d2.js";import"./jss-plugin-global-96037998.js";import"./jss-plugin-nested-279c4525.js";import"./jss-plugin-camel-case-92f9f32c.js";import"./hyphenate-style-name-80972348.js";import"./jss-plugin-default-unit-80d6b696.js";import"./jss-plugin-vendor-prefixer-711b305d.js";import"./css-vendor-f41dfb6e.js";import"./jss-plugin-props-sort-0c9fca2f.js";import"./react-router-dom-c0e9fbdc.js";import"./react-router-11fb21ef.js";import"./@remix-run-d753ad9e.js";import"./highlight-words-42d92bcd.js";import"./rc-input-number-5ce3f958.js";import"./classnames-e62508ea.js";import"./rc-util-f84322a6.js";import"./@rc-component-9042d6d8.js";/* empty css                     */import"./react-toastify-ac6b7c37.js";import"./clsx-1229b3e0.js";import"./react-datepicker-b19bab85.js";import"./date-fns-66b136a8.js";import"./react-onclickoutside-a7243ba6.js";import"./react-popper-4d77a87f.js";import"./warning-4834017b.js";import"./react-redux-0edfc849.js";import"./use-sync-external-store-b3a8aa83.js";import"./lodash-c8b5ff2a.js";import"./jwt-decode-9c18df67.js";import"./nanoid-bef4f1f3.js";import"./@reduxjs-e99b2c47.js";import"./immer-41fd5235.js";import"./redux-5bd193e3.js";import"./redux-thunk-ef899f4c.js";import"./form-data-c8368213.js";import"./extract-files-b993d67a.js";import"./graphql-9eaaa955.js";import"./cross-fetch-ff4a750f.js";import"./sweetalert2-b5adf0ab.js";import"./FormTextField-3f227e6b.js";import"./react-select-753177b7.js";import"./@floating-ui-de51804c.js";import"./use-isomorphic-layout-effect-2578e237.js";import"./memoize-one-297ddbcb.js";import"./AlertLoading-3592644c.js";import"./ReactSelect-5115d3bc.js";import"./yup-861a4b8a.js";import"./property-expr-38205fa5.js";import"./tiny-case-d0726479.js";import"./toposort-85f95ecf.js";import"./yup-locales-e98f4908.js";const Pe=M`
  mutation CLIENTE_ELIMINAR($codigosCliente: [String]!) {
    clientesEliminar(codigosCliente: $codigosCliente)
  }
`,ke=async e=>{try{const t=new F("https://sandbox.isipass.net/api"),i=localStorage.getItem(E);return t.setHeader("authorization",`Bearer ${i}`),(await t.request(Pe,{codigosCliente:e})).clientesEliminar}catch(t){throw new T(t)}},$e=M`
  mutation CLIENTE_99001_ACTUALIZAR($id: ID!, $input: Cliente99001UpdateInput!) {
    cliente99001Update(id: $id, input: $input) {
      _id
      razonSocial
      tipoDocumentoIdentidad {
        codigoClasificador
        descripcion
      }
      codigoCliente
      numeroDocumento
      complemento
      nombres
      apellidos
      email
      codigoExcepcion
    }
  }
`,Ue=async(e,t)=>{try{const i=new F("https://sandbox.isipass.net/api"),r=localStorage.getItem(E);return i.setHeader("authorization",`Bearer ${r}`),(await i.request($e,{id:e,input:t})).cliente99001Update}catch(i){throw new T(i)}},Be=e=>({nombres:d(e.nombres,""),apellidos:d(e.apellidos,""),email:e.email,razonSocial:e.razonSocial}),Le=(e,t)=>({codigoCliente:e.codigoCliente,razonSocial:e.razonSocial,email:e.email,nombres:d(e.nombres,""),apellidos:d(e.apellidos,""),action:t}),Ne=e=>{const{onClose:t,keepMounted:i,open:r,cliente:n,...f}=e,c=V({defaultValues:{...De,action:x.UPDATE},resolver:q(be)}),p=async u=>{const g=await Ae();if(g.length>0)G(g.join("<br>"));else{const h=Be(u);await v({preConfirm:async()=>{const a=await Ue(n._id,h).catch(b=>({error:b}));return a.error?(y(a.error),!1):a}}).then(a=>{a.isConfirmed&&(R(),t(a.value)),a.isDenied&&y(a.value)})}},D=(u,g)=>console.log(u,g);return m.useEffect(()=>{r&&n&&r&&c.reset(Le(n,x.UPDATE))},[r]),o(A,{children:l(B,{sx:{"& .MuiDialog-paper":{width:"90%",maxHeight:600}},maxWidth:"sm",keepMounted:i,open:r,...f,children:[l(L,{children:["Actualizar cliente 99001 ",n.razonSocial]}),o(N,{dividers:!0,children:o(we,{form:c})}),l(_,{children:[o(S,{autoFocus:!0,color:"error",variant:"contained",size:"small",onClick:()=>{t()},children:"Cancelar"}),o(S,{onClick:c.handleSubmit(p,D),style:{marginRight:15},size:"small",variant:"contained",children:"Guardar Cambios"})]})]})})},_e=M`
  mutation CLIENTE_ACTUALIZACION($id: ID!, $input: ClienteUpdateInput!) {
    clienteUpdate(id: $id, input: $input) {
      _id
      razonSocial
      tipoDocumentoIdentidad {
        codigoClasificador
        descripcion
      }
      codigoCliente
      numeroDocumento
      complemento
      nombres
      apellidos
      email
      codigoExcepcion
    }
  }
`,Ge=async(e,t)=>{try{const i=new F("https://sandbox.isipass.net/api"),r=localStorage.getItem(E);return i.setHeader("authorization",`Bearer ${r}`),(await i.request(_e,{id:e,input:t})).clienteUpdate}catch(i){throw new T(i)}},qe=e=>({apellidos:d(e.apellidos,""),complemento:d(e.complemento,""),email:d(e.email,""),nombres:d(e.nombres,""),numeroDocumento:e.numeroDocumento,razonSocial:e.razonSocial,telefono:d(e.telefono,"")}),Ve=(e,t)=>({sinTipoDocumento:e.tipoDocumentoIdentidad,razonSocial:e.razonSocial,numeroDocumento:e.numeroDocumento,complemento:d(e.complemento,""),email:e.email,nombres:d(e.nombres,""),apellidos:d(e.apellidos,""),telefono:d(e.telefono,""),action:t}),He=e=>{const{onClose:t,keepMounted:i,open:r,cliente:n,...f}=e,c=V({defaultValues:{...ye,action:x.UPDATE},resolver:q(ze)}),p=async u=>{const g=await Ie();if(g.length>0)G(g.join("<br>"));else{const h=qe(u);await v({preConfirm:async()=>{const a=await Ge(n._id,h).catch(b=>({error:b}));return a.error?(y(a.error),!1):a}}).then(a=>{a.isConfirmed&&(R(),t(a.value)),a.isDenied&&y(a.value)})}},D=(u,g)=>console.log(u,g);return m.useEffect(()=>{n&&r&&c.reset(Ve(n,x.UPDATE))},[r]),o(A,{children:l(B,{sx:{"& .MuiDialog-paper":{width:"100%",maxHeight:800}},maxWidth:"sm",keepMounted:i,open:r,...f,children:[l(L,{children:["Actualizar cliente ",n.razonSocial]}),o(N,{dividers:!0,children:o(xe,{form:c})}),l(_,{children:[o(S,{autoFocus:!0,color:"error",variant:"contained",size:"small",onClick:()=>{t()},children:"Cancelar"}),o(S,{onClick:c.handleSubmit(p,D),style:{marginRight:15},size:"small",variant:"contained",disabled:!c.formState.isValid,children:"Guardar Cambios"})]})]})})},Oe=e=>{const{row:t,refetch:i}=e,[r,n]=m.useState(!1),[f,c]=m.useState(!1);return l(A,{children:[l("div",{style:{display:"flex",flexWrap:"nowrap",gap:"0.5rem",width:100},children:[o(Re,{menuButton:o(A,{children:o(J,{"aria-label":"menuGestionRoles",children:o(X,{})})}),children:l(Me,{onClick:()=>{t.numeroDocumento==="99001"?c(!0):n(!0)},children:[o(Y,{})," Modificar"]})}),o(ce,{row:t})]}),o(He,{id:"clienteActualizarDialgo",keepMounted:!1,open:r,cliente:t,onClose:p=>{n(!1),p&&i().then()}}),o(Ne,{id:"cliente99001ActualizarDialgo",keepMounted:!1,open:f,cliente:t,onClose:p=>{c(!1),p&&i().then()}})]})},je=[{accessorKey:"codigoCliente",header:"Código Cliente"},{accessorKey:"razonSocial",header:"Razon Social"},{accessorFn:e=>`${e.numeroDocumento}${e.complemento?`-${e.complemento}`:""}`,id:"numeroDocumento",header:"Nro. Documento"},{id:"email",header:"Correo",accessorKey:"email"},{accessorKey:"tipoDocumentoIdentidad.descripcion",id:"tipoDocumentoIdentidad.descripcion",header:"Tipo Documento"},{accessorFn:e=>o(ae,{size:"small",label:e.state,color:"success"}),id:"state",header:"Estado"}],Qe=e=>{const[t,i]=m.useState(!1),[r,n]=m.useState(!1),[f,c]=m.useState(0),[p,D]=m.useState([]),[u,g]=m.useState([]),[h,a]=m.useState({pageIndex:I.page,pageSize:I.limit}),[b,P]=m.useState({}),[We,k]=m.useState(!1),H=async()=>{k(!0);try{await w()}catch(s){console.error("Error al recargar los datos:",s)}k(!1)},{data:O,isError:$,isLoading:j,isFetching:Q,refetch:w}=Fe(["client",p,h.pageIndex,h.pageSize,u],async()=>{const s=pe(p),z={...I,page:h.pageIndex+1,limit:h.pageSize,reverse:u.length<=0,query:s},{pageInfo:C,docs:Z}=await ve(z);return c(C.totalDocs),Z},{keepPreviousData:!0}),W=m.useMemo(()=>je,[]),K=async s=>{const z=s.map(C=>C.original.codigoCliente);if(z.length===0){Se("No se ha seleccionado ningun registro, vuelva a intentar");return}await v({text:"Confirma que desea eliminar los registros seleccionados y sus respectivas variantes, esta operación no se podra revertir",preConfirm:()=>ke(z).catch(C=>(y(C),!1))}).then(C=>{C.isConfirmed&&(R(),P({}),w().then())})};return l(A,{children:[l(ee,{direction:{xs:"column",sm:"row"},spacing:1,justifyContent:"right",sx:{marginBottom:3},children:[l(S,{size:"small",variant:"contained",onClick:()=>i(!0),startIcon:o(oe,{}),color:"primary",children:[" ","Nuevo Cliente"]}),o(S,{size:"small",variant:"contained",onClick:()=>n(!0),color:"primary",children:"Nuevo Cliente (99001)"})]}),o(le,{columns:W,data:O??[],initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,muiToolbarAlertBannerProps:ue($),onColumnFiltersChange:D,onPaginationChange:a,onSortingChange:g,enableDensityToggle:!1,enableGlobalFilter:!1,rowCount:f,localization:de,enableRowNumbers:!0,state:{isLoading:j,columnFilters:p,pagination:h,showAlertBanner:$,showProgressBars:Q,sorting:u,density:"compact",rowSelection:b},enableRowActions:!0,positionActionsColumn:"first",renderRowActions:({row:s})=>o(Oe,{row:s.original,refetch:w}),muiSearchTextFieldProps:ge,muiTableHeadCellFilterTextFieldProps:he,muiTableProps:fe,displayColumnDefOptions:Ce,onRowSelectionChange:P,enableRowSelection:!0,muiSelectCheckboxProps:({row:s})=>({disabled:["99003","99002"].includes(s.getValue("numeroDocumento"))}),renderTopToolbarCustomActions:({table:s})=>l(te,{sx:{display:"flex",gap:"1rem",p:"0.5rem",flexWrap:"wrap"},children:[o(me,{refetch:H,sx:{flexGrow:1}}),o(S,{color:"error",onClick:()=>K(s.getSelectedRowModel().flatRows),startIcon:o(ie,{}),variant:"contained",size:"small",disabled:s.getSelectedRowModel().flatRows.length===0,sx:{height:"28px",top:"0.5rem"},children:"Eliminar"})]})}),o(Ee,{id:"clienteRegistroDialgo",keepMounted:!1,open:t,onClose:s=>{s&&w().then(),i(!1)}}),o(Te,{id:"cliente99001Registro",keepMounted:!1,open:r,onClose:s=>{n(!1),s&&w().then()}})]})},Dt=e=>l(ne,{children:[o("div",{className:"breadcrumb",children:o(se,{routeSegments:[{name:"Gestion de clientes",path:"/clientes/gestion"}]})}),o("form",{noValidate:!0,children:o(U,{container:!0,spacing:2,children:o(U,{item:!0,lg:12,md:12,xs:12,children:o(Qe,{})})})}),o(re,{py:"12px"})]});export{Dt as default};
