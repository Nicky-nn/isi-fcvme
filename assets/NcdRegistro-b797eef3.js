import{j as e,F as b,ay as m,a as l,aA as M,aY as K,U as V,_ as $,$ as Q,W as H,aG as W,aW as j,aX as R,P as I,a1 as _,f as X,Z,a0 as Y,aZ as J,aB as ee}from"./@mui-94e45ada.js";import{o as te}from"./@hookform-4c1cadd7.js";import{b as ae,u as re}from"./react-hook-form-f9fec52a.js";import{Q as oe}from"./react-toastify-ac6b7c37.js";import{S as ie}from"./sweetalert2-b5adf0ab.js";import{w as ne}from"./sweetalert2-react-content-a221181a.js";import{S as le,B as se}from"./Breadcrumb-c4cf427b.js";import{R as ce}from"./RepresentacionGraficaUrls-713a010f.js";import{A as me,a as de,o as w,u as ue,n as pe}from"./index-a032e14e.js";import{s as he,b as fe,a as ge}from"./swal-6db6c20f.js";import{g as Ce,G as Se}from"./graphql-request-396d023b.js";import{s as be,c as T,a as Fe,d as De,e as E}from"./yup-861a4b8a.js";import{e as xe}from"./yup-locales-e98f4908.js";import{I as we}from"./rc-input-number-5ce3f958.js";import{n as g}from"./NumberInput-1ec990a6.js";import{S as z}from"./SimpleCard-cc9110a7.js";import{r as s}from"./react-19ede8c0.js";import{Q as Ie}from"./react-data-table-component-8684ed73.js";import{F as x}from"./FormTextField-3f227e6b.js";import{M as ye}from"./material-react-table-1f8ebe78.js";import{S as Ae,a as y}from"./SimpleMenu-fe44c236.js";import{P as N,l as Re}from"./localization-3d90e8d6.js";import{m as Te}from"./materialReactTableUtils-e433a167.js";import{f as Ee}from"./factura.listado.api-140e1c24.js";import{e as Ne}from"./@tanstack-464f39f1.js";import"./react-is-e5978b8b.js";import"./@emotion-01c0502c.js";import"./hoist-non-react-statics-6e7e3bdb.js";import"./@babel-41a3dc83.js";import"./stylis-79144faa.js";import"./react-transition-group-07c33d75.js";import"./react-dom-308b05ff.js";import"./scheduler-765c72db.js";import"./@popperjs-f3391c26.js";import"./jss-4560bbb1.js";import"./is-in-browser-9e40da8a.js";import"./jss-plugin-rule-value-function-275843d2.js";import"./jss-plugin-global-96037998.js";import"./jss-plugin-nested-279c4525.js";import"./jss-plugin-camel-case-92f9f32c.js";import"./hyphenate-style-name-80972348.js";import"./jss-plugin-default-unit-80d6b696.js";import"./jss-plugin-vendor-prefixer-711b305d.js";import"./css-vendor-f41dfb6e.js";import"./jss-plugin-props-sort-0c9fca2f.js";import"./clsx-1229b3e0.js";import"./react-router-dom-c0e9fbdc.js";import"./react-router-11fb21ef.js";import"./@remix-run-d753ad9e.js";/* empty css                     */import"./react-datepicker-b19bab85.js";import"./classnames-e62508ea.js";import"./date-fns-66b136a8.js";import"./react-onclickoutside-a7243ba6.js";import"./react-popper-4d77a87f.js";import"./warning-4834017b.js";import"./react-redux-0edfc849.js";import"./use-sync-external-store-b3a8aa83.js";import"./lodash-c8b5ff2a.js";import"./jwt-decode-9c18df67.js";import"./nanoid-bef4f1f3.js";import"./@reduxjs-e99b2c47.js";import"./immer-41fd5235.js";import"./redux-5bd193e3.js";import"./redux-thunk-ef899f4c.js";import"./rc-util-f84322a6.js";import"./@rc-component-9042d6d8.js";import"./form-data-c8368213.js";import"./extract-files-b993d67a.js";import"./graphql-9eaaa955.js";import"./cross-fetch-ff4a750f.js";import"./property-expr-38205fa5.js";import"./tiny-case-d0726479.js";import"./toposort-85f95ecf.js";import"./Typography-c4fd38d1.js";import"./styled-components-4b605e15.js";import"./highlight-words-42d92bcd.js";const ze=Ce`
  mutation NCD_ALQ_REGISTRO($input: NotaDebitoCreditoAlqInput!) {
    notaCreditoDebitoAlqRegistro(input: $input) {
      cuf
      state
      numeroFactura
      numeroNotaCreditoDebito
      representacionGrafica {
        pdf
        rollo
        xml
        sin
      }
    }
  }
`,Oe=async r=>{const o=new Se("https://sandbox.isipass.net/api"),i=localStorage.getItem(me);return o.setHeader("authorization",`Bearer ${i}`),(await o.request(ze,{input:r})).notaCreditoDebitoAlqRegistro},Pe=r=>({facturaCuf:r.facturaCuf,detalle:r.detalleFactura.map(o=>({itemFactura:o.nroItem,cantidad:o.cantidad}))});be(xe);const ve=T({facturaCuf:Fe().trim().required("Código Único de factura es requerido"),detalleFactura:De().of(T({nroItem:E().required("Debbe Seleccionar un item"),cantidad:E().required()}))}),ke=r=>{const{form:{control:o,getValues:i,formState:{errors:d}}}=r,{update:C}=ae({control:o,name:"detalleFactura"});return e(b,{children:e(z,{title:"DATOS DE LA DEVOLUCIÓN",children:e(m,{container:!0,spacing:3,children:e(m,{item:!0,lg:12,md:12,xs:12,sx:{pt:10},children:e("div",{className:"responsive-table",style:{marginTop:20},children:l("table",{children:[e("thead",{children:l("tr",{children:[e("th",{scope:"col",style:{width:100},children:"NRO. ITEM"}),e("th",{scope:"col",style:{width:160},children:"CANTIDAD"}),e("th",{scope:"col",children:"DESCRIPCION"}),e("th",{scope:"col",style:{width:160},children:"PRECIO UNITARIO"}),e("th",{scope:"col",style:{width:160},children:"DESCUENTO"})]})}),e("tbody",{children:i("detalleFactura").length>0&&i("detalleFactura").map((a,u)=>l("tr",{children:[e("td",{"data-label":"NRO.ITEM",children:a.nroItem}),e("td",{"data-label":"CANTIDAD",children:e(we,{min:.1,max:a.cantidadOriginal,value:a.cantidad,onChange:n=>{n&&n>=0&&C(u,{...a,cantidad:n})},formatter:g})}),e("td",{"data-label":"DESCRIPCIÓN",children:a.descripcion}),e("td",{"data-label":"PRECIO",style:{textAlign:"right"},children:g(a.precioUnitario,{})}),e("td",{"data-label":"DESCUENTO",style:{textAlign:"right"},children:g(a.montoDescuento,{})})]},a.nroItem))})]})})})})})})},Be=[{header:"Número",accessorKey:"numeroFactura",size:120},{accessorKey:"fechaEmision",header:"Fecha Emisión",id:"fechaEmision",size:150,enableColumnFilter:!1},{header:"Importe",accessorKey:"montoTotal",muiTableBodyCellProps:{align:"right"},Cell:({cell:r})=>e("span",{children:g(r.getValue(),{})}),size:100,enableColumnFilter:!1},{header:"Razon Social",id:"cliente.razonSocial",accessorKey:"cliente.razonSocial",maxSize:180},{id:"cliente.numeroDocumento",header:"Nro. Documento",accessorFn:r=>l("span",{children:[r.cliente.numeroDocumento," ",r.cliente.complemento?`-${r.cliente.complemento}`:""]}),filterFn:(r,o,i)=>r.original.cliente.numeroDocumento.startsWith(i)},{accessorKey:"cuf",id:"cuf",header:"C.U.F."},{accessorKey:"state",id:"state",header:"ESTADO"}],Ge=r=>{const{onClose:o,open:i,...d}=r,C=()=>{o()},[a,u]=s.useState([]),[n,F]=s.useState({pageIndex:N.page,pageSize:5}),[h,S]=s.useState(0),[f,t]=s.useState(!1),[D,p]=s.useState([]);s.useState("");const[O,qe]=s.useState({}),{data:P,isError:A,isLoading:v,refetch:Le}=Ne(["NcdGestionFacturas",a,n.pageIndex,n.pageSize,D],async()=>{const c=de(a,["state=VALIDADA"]),U={...N,page:n.pageIndex+1,limit:n.pageSize,reverse:D.length<=0,query:c},{pageInfo:q,docs:L}=await Ee(U);return S(q.totalDocs),L}),k=s.useMemo(()=>Be,[]),B=c=>{o(c)},G=M(K)(({theme:c})=>({backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.5)",zIndex:c.zIndex.drawer+1}));return e(b,{children:l(V,{sx:{"& .MuiDialog-paper":{width:"100%",maxHeight:550}},maxWidth:"lg",open:i,onClose:()=>{o()},onKeyDown:c=>{c.key==="Escape"&&o()},BackdropComponent:G,...d,children:[e($,{children:"Seleccione su Factura"}),e(Q,{dividers:!0,children:e(ye,{columns:k,data:P??[],initialState:{showColumnFilters:!0,columnVisibility:{cuf:!1,state:!1}},manualFiltering:!0,manualPagination:!0,manualSorting:!0,muiToolbarAlertBannerProps:A?{color:"error",children:"Error loading data"}:void 0,onColumnFiltersChange:u,onPaginationChange:F,onSortingChange:p,enableDensityToggle:!1,enableGlobalFilter:!1,rowCount:h,localization:Re,state:{isLoading:v,columnFilters:a,pagination:n,showAlertBanner:A,showProgressBars:f,density:"compact",sorting:D,rowSelection:O},muiSearchTextFieldProps:{variant:"outlined",placeholder:"Busqueda",InputLabelProps:{shrink:!0},size:"small"},enableRowActions:!0,positionActionsColumn:"first",renderRowActions:({row:c})=>l(b,{children:[l(Ae,{menuButton:e(b,{children:e(H,{"aria-label":"delete",children:e(W,{})})}),children:[l(y,{onClick:()=>{w(c.original.representacionGrafica.pdf)},children:[e(j,{})," Pdf Medio Oficio"]}),l(y,{onClick:()=>{w(c.original.representacionGrafica.xml)},children:[e(R,{})," Xml"]}),l(y,{onClick:()=>{w(c.original.representacionGrafica.sin)},children:[e(R,{})," Url S.I.N."]})]}),e(I,{size:"small",variant:"contained",color:"info",onClick:()=>B(c.original),style:{width:"70px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"12px"},children:"Seleccionar"})]}),muiTableHeadCellFilterTextFieldProps:{...Te},muiTableProps:{sx:{tableLayout:"fixed"}},displayColumnDefOptions:{"mrt-row-actions":{muiTableHeadCellProps:{align:"center"},size:120}}})}),e(_,{children:e(I,{autoFocus:!0,color:"error",size:"small",variant:"contained",onClick:C,children:"Cerrar"})})]})})},Ue=r=>{const{form:{control:o,setValue:i,getValues:d,watch:C,formState:{errors:a}}}=r,[u,n]=s.useState(!1),[F,h]=s.useState([]),S=s.useMemo(()=>[{name:"Nro. Item",selector:t=>t.nroItem,width:"100px"},{name:"Cantidad",selector:t=>t.cantidad,width:"100px"},{name:"Descripción",selector:t=>t.descripcion},{name:"Descuento",selector:t=>g(t.montoDescuento,{}),right:!0,width:"160px"},{name:"Precio Unitario",selector:t=>g(t.precioUnitario,{}),right:!0,width:"160px"},{name:"Sub Total",selector:t=>g(t.subTotal,{}),right:!0,width:"160px"}],[]),f=s.useCallback(t=>{h(t.selectedRows);const D=t.selectedRows.map(p=>({nroItem:p.nroItem,cantidadOriginal:p.cantidad,cantidad:p.cantidad,descripcion:p.descripcion,montoDescuento:p.montoDescuento,precioUnitario:p.precioUnitario,subTotal:p.subTotal}));i("detalleFactura",D)},[]);return s.useEffect(()=>{h([]),i("detalleFactura",[])},[]),l(b,{children:[e(z,{title:"DATOS DE LA FACTURA ORIGINAL",children:l(m,{container:!0,spacing:3,children:[l(m,{item:!0,lg:12,children:[e(I,{size:"small",variant:"contained",color:"info",onClick:()=>n(!0),children:"Seleccionar Factura"}),e("hr",{})]}),e(m,{item:!0,lg:2,md:2,xs:12,children:e(x,{name:"numeroFactura",label:"Número Factura",value:d("numeroFactura"),autoComplete:"off"})}),e(m,{item:!0,lg:4,md:4,xs:12,children:e(x,{name:"fechaEmision",label:"Fecha Emisión",value:d("fechaEmision")})}),e(m,{item:!0,lg:6,md:6,xs:12,children:e(x,{name:"razonSocial",label:"Razon Social",value:d("razonSocial")})}),e(m,{item:!0,lg:12,md:12,xs:12,children:e(x,{name:"cuf",label:"Código Control (C.U.F.)",value:d("facturaCuf")})}),l(m,{item:!0,lg:12,md:12,xs:12,sx:{pt:10},children:[e(X,{gutterBottom:!0,variant:"subtitle1",children:"Detalle"}),e(Ie,{columns:S,data:d("detalle"),selectableRows:!0,onSelectedRowsChange:f,dense:!0})]})]})}),e(b,{children:e(Ge,{id:"ncdFacturaOriginalDialogSeleccion",keepMounted:!1,open:u,onClose:t=>{n(!1),t&&(i("numeroFactura",t.numeroFactura.toString()),i("fechaEmision",t.fechaEmision),i("razonSocial",t.cliente.razonSocial),i("facturaCuf",t.cuf),i("detalleFactura",[]),i("detalle",t.detalle),h([]))}})})]})},ua=()=>{ue();const r=ne(ie),o=re({defaultValues:{numeroFactura:"",fechaEmision:"",razonSocial:"",facturaCuf:"",detalleFactura:[],detalle:[]},resolver:te(ve)}),i=async d=>{const C=Pe(d);await he({preConfirm:async()=>{var u,n,F,h,S;const a=await Oe(C).catch(f=>({error:f}));if(a!=null&&a.error){const f=((S=(h=(F=(n=(u=a.error)==null?void 0:u.response)==null?void 0:n.data)==null?void 0:F.data)==null?void 0:h[0])==null?void 0:S.field)??"unknown field",t="El campo es requerido.";return oe.error(t),o.setError(f,{message:t}),!1}return a}}).then(a=>{if(a.isConfirmed){const{value:u}=a,{representacionGrafica:n}=u;r.fire({title:"Documento Generado Correctamente",html:e(ce,{representacionGrafica:n})}),o.reset({numeroFactura:"",fechaEmision:"",razonSocial:"",facturaCuf:"",detalleFactura:[]}),fe(),w(n.pdf)}a.isDenied&&ge(a.value)})};return l(le,{children:[e("div",{className:"breadcrumb",children:e(se,{routeSegments:[{name:"Notas Crédito Debito",path:pe.gestion},{name:"Registrar Nota"}]})}),e(Z,{elevation:0,variant:"elevation",square:!0,sx:{mb:2,p:.5},className:"asideSidebarFixed",children:e(Y,{direction:{xs:"column",sm:"row"},style:{marginTop:2},spacing:{xs:1,sm:1,md:1,xl:1},justifyContent:"flex-end",children:e(I,{color:"success",startIcon:e(J,{}),variant:"contained",onClick:o.handleSubmit(i),children:"Registrar Nota"})})}),e("form",{children:l(m,{container:!0,spacing:2,children:[e(m,{item:!0,lg:12,children:e(Ue,{form:o})}),e(m,{item:!0,lg:12,children:e(ke,{form:o})})]})}),e(ee,{py:"12px"})]})};export{ua as default};
