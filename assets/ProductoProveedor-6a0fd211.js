import{g as N,A as B,u as Y,h as oo}from"./index-a032e14e.js";import{c as F,a as O,f as V,e as q,s as j}from"./yup-861a4b8a.js";import{e as Q}from"./yup-locales-e98f4908.js";import{j as o,F as H,a as m,ay as g,aL as y,ao as E,M as eo,U as ro,_ as io,$ as to,a1 as ao,P as U}from"./@mui-94e45ada.js";import{r as A}from"./react-19ede8c0.js";import{C as S}from"./react-hook-form-f9fec52a.js";import{S as I}from"./react-select-753177b7.js";import{A as _,a as G}from"./AlertLoading-3592644c.js";import{M as D,r as $}from"./ReactSelect-5115d3bc.js";import{S as M}from"./SimpleCard-cc9110a7.js";import{g as T,G as w}from"./graphql-request-396d023b.js";import{e as k}from"./@tanstack-464f39f1.js";import{u as no}from"./formik-bccae489.js";import{s as co,a as so,b as lo}from"./swal-6db6c20f.js";import{F as L}from"./FormTextField-3f227e6b.js";import{u as uo}from"./useQueryActividadesPorDocumentoSector-b0197bf8.js";import{I as go}from"./rc-input-number-5ce3f958.js";import{n as po}from"./NumberInput-1ec990a6.js";import{P as mo,a as ho}from"./ProveedorRegistroDialog-e75467b3.js";const Qo=r=>{var e,i,s,c,d;return{nombre:r.nombre,descripcion:r.descripcion,descripcionHtml:r.descripcionHtml,codigoActividad:(e=r.codigoActividad)==null?void 0:e.codigoActividad,codigoProductoSin:(i=r.codigoProductoSin)==null?void 0:i.codigoProducto,precio:r.precio,codigoUnidadMedida:parseInt(N((s=r.codigoUnidadMedida)==null?void 0:s.codigoClasificador,0),10),tipoProductoId:(c=r.tipoProducto)==null?void 0:c._id,codigoProveedor:(d=r.codigoProveedor)==null?void 0:d.codigo}},Go=async r=>{j(Q);const e=F({codigoProducto:O().required("Debe ingresar el código del producto"),nombre:O().required("Debe ingresar el nombre del producto"),codigoActividad:V().required("Debe seleccionar la actividad económica"),codigoProductoSin:V().required("Debe seleccionar el producto sin"),precio:q().min(1).required("Debe ingresar el precio del producto"),codigoUnidadMedida:q().required("Debe seleccionar la unidad de medida")});try{return await e.validate(r,{abortEarly:!1}),!0}catch(i){return console.log(i),!1}},Zo=F({codigoProducto:O().required("Debe ingresar el código del producto"),nombre:O().required(),codigoActividad:V().required(),codigoProductoSin:V().required(),precio:q().min(0).required(),codigoUnidadMedida:V().required()}),vo=T`
  query TIPOS_PRODUCTO {
    tiposProductos {
      _id
      descripcion
      codigoParent
      parientes
      state
      usucre
      createdAt
      usumod
      UpdatedAt
    }
  }
`,Po=async()=>{const r=new w("https://sandbox.isipass.net/api"),e=localStorage.getItem(B);return r.setHeader("authorization",`Bearer ${e}`),(await r.request(vo)).tiposProductos||[]},Z=(r=[])=>{const{data:e,isLoading:i,isError:s,error:c,refetch:d}=k(["tiposProducto",...r],async()=>{const a=await Po();return a.length>0?a:[]});return{tiposProducto:e,tpLoading:i,tpIsError:s,tpError:c,tpRefetch:d}},fo=T`
  mutation TIPO_PRODUCTO_REGISTRO($input: TipoProductoInput!) {
    tipoProductoRegistro(input: $input) {
      _id
      descripcion
      codigoParent
      parientes
      state
      usucre
      createdAt
      usumod
      UpdatedAt
    }
  }
`,Co=async r=>{const e=new w("https://sandbox.isipass.net/api"),i=localStorage.getItem(B);return e.setHeader("authorization",`Bearer ${i}`),(await e.request(fo,{input:r})).tipoProductoRegistro},So={codigoParent:null,descripcion:""};j(Q);const bo=F({codigoParent:O().nullable(),descripcion:O().required()}),Ao=r=>{const{formik:e}=r,{tiposProducto:i,tpLoading:s,tpError:c,tpIsError:d}=Z();return d?o(_,{mensaje:c.message}):o(H,{children:o("form",{noValidate:!0,children:m(g,{container:!0,spacing:2,children:[o(g,{item:!0,xs:12,md:12,lg:12,children:s?o(G,{}):m(y,{fullWidth:!0,color:"warning",error:!!e.errors.codigoParent,children:[o(D,{shrink:!0,children:"Tipo Producto"}),o(I,{styles:$,menuPosition:"fixed",name:"codigoParent",isClearable:!0,placeholder:"Seleccione el tipo de actividad",value:i?i.find(a=>a._id===e.values.codigoParent):null,onChange:async a=>{e.setFieldValue("codigoParent",N(a==null?void 0:a._id,null))},isSearchable:!1,options:i,getOptionValue:a=>a._id,getOptionLabel:a=>`${a.parientes}`}),o(E,{children:e.errors.codigoParent})]})}),o(g,{item:!0,xs:12,md:12,lg:12,children:o(eo,{name:"descripcion",label:"Descripción",size:"small",fullWidth:!0,value:e.values.descripcion,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.descripcion&&!!e.errors.descripcion,helperText:e.touched.descripcion&&e.errors.descripcion})})]})})})},xo=r=>{const{onClose:e,open:i,...s}=r,c=no({initialValues:So,validationSchema:bo,onSubmit:async a=>{await co({preConfirm:()=>Co(a).catch(h=>(so(h),!1)),text:"Confirma que desea reagistrar al proveedor"}).then(h=>{h.isConfirmed&&(lo(),e(h.value))})}}),d=()=>{e()};return A.useEffect(()=>{c.resetForm()},[i]),o(H,{children:m(ro,{sx:{"& .MuiDialog-paper":{width:"100%",maxHeight:500}},maxWidth:"sm",open:i,...s,children:[o(io,{children:"Registrar nuevo clasificador de productos"}),o(to,{dividers:!0,children:o(Ao,{formik:c})}),m(ao,{children:[o(U,{autoFocus:!0,color:"error",size:"small",variant:"contained",onClick:d,children:"Cancelar"}),o(U,{onClick:c.submitForm,size:"small",style:{marginRight:25},variant:"contained",disabled:!c.isValid,children:"Registrar Clasificador"})]})]})})},Ko=r=>{const{form:{control:e,setValue:i,formState:{errors:s}}}=r,[c,d]=A.useState(!1),{tiposProducto:a,tpRefetch:h,tpLoading:p}=Z([c]);return o(M,{title:"Clasificador de Servicios",children:m(g,{container:!0,spacing:1,children:[o(g,{item:!0,lg:12,md:12,xs:12,children:p?o(G,{}):o(S,{control:e,name:"tipoProducto",render:({field:l})=>{var b;return m(y,{fullWidth:!0,children:[o(D,{shrink:!0,children:"Tipo Sercicio"}),o(I,{...l,styles:$,menuPosition:"fixed",name:"tipoProducto",placeholder:"Seleccione...",value:l.value,onChange:f=>{l.onChange(f)},options:a,isClearable:!0,getOptionValue:f=>f._id,getOptionLabel:f=>`${f.parientes}`}),o(E,{error:!!s.tipoProducto,children:(b=s.tipoProducto)==null?void 0:b.message})]})}})}),m(g,{item:!0,lg:12,md:12,xs:12,textAlign:"right",children:[o(U,{variant:"outlined",onClick:()=>d(!0),size:"small",children:"Nuevo Clasificador"}),o(xo,{id:"tipoProductoDialogRegistro",keepMounted:!1,open:c,onClose:l=>{d(!1),l&&(i("tipoProducto",l),h().then())}})]})]})})};T`
  query PRODUCTO_SERVICIO {
    sinProductoServicio {
      codigoActividad
      codigoProducto
      descripcionProducto
    }
  }
`;const yo=T`
  query PRODUCTO_SERVICIO_POR_ACTIVIDAD($codigoActividad: String!) {
    sinProductoServicioPorActividad(codigoActividad: $codigoActividad) {
      codigoActividad
      codigoProducto
      descripcionProducto
    }
  }
`,Do=async r=>{const e=new w("https://sandbox.isipass.net/api"),i=localStorage.getItem(B);return e.setHeader("authorization",`Bearer ${i}`),(await e.request(yo,{codigoActividad:r||""})).sinProductoServicioPorActividad},Jo=r=>{const{form:{control:e,setValue:i,getValues:s,watch:c,formState:{errors:d,isSubmitting:a}}}=r,h=c("codigoActividad"),[p,l]=A.useState(""),b=t=>{const n=t.toUpperCase().replace(/[^A-Z0-9 ]/g,"").split(" ").map(X=>X.substring(0,5));let u;n.length>3?u=[...n.slice(0,5),...n.slice(-2)]:u=n;const v=u.join("");let R=Math.floor(Math.random()*100);R<10&&(R+=10);const J=`${v}-${R}`.slice(0,Math.min(13,v.length+4));return t.length>0?J:""};A.useEffect(()=>{const t=s("nombre"),u=s("codigoProducto")||b(t);l(u),i("codigoProducto",u)},[s,i,c("nombre")?c("nombre"):""]);const{user:f}=Y(),{actividades:x,actIsError:C,actError:P,actLoading:W}=uo(),{data:K,error:z}=k(["productosServicios",h],async()=>await Do(s("codigoActividad.codigoActividad")),{keepPreviousData:!1});return A.useEffect(()=>{if(!W&&x&&x.length>0){const t=x.find(n=>n.codigoActividad===f.actividadEconomica.codigoCaeb);t?i("codigoActividad",t):i("codigoActividad",null)}},[W,x]),A.useState(!1),A.useState(""),o(H,{children:o(M,{title:"HOMOLOGACIÓN",children:m(g,{container:!0,spacing:3,children:[o(g,{item:!0,lg:12,md:12,xs:12,children:P?o(_,{mensaje:P.message}):o(S,{name:"codigoActividad",control:e,render:({field:t})=>m(y,{fullWidth:!0,error:!!d.codigoActividad,children:[o(D,{shrink:!0,children:"Actividad Económica"}),o(I,{...t,styles:$,name:"codigoActividad",placeholder:"Seleccione la actividad económica",menuPosition:"fixed",value:s("codigoActividad"),onChange:async n=>{t.onChange(n),i("codigoProductoSin",null)},onBlur:async n=>{t.onBlur()},isSearchable:!1,options:x,getOptionValue:n=>n.codigoActividad,getOptionLabel:n=>`${n.tipoActividad} - ${n.codigoActividad} - ${n.actividadEconomica}`})]})})}),o(g,{item:!0,lg:12,md:12,xs:12,children:z?o(_,{mensaje:z.message}):o(S,{name:"codigoProductoSin",control:e,render:({field:t})=>{var n;return m(y,{fullWidth:!0,component:"div",error:!!d.codigoProductoSin,children:[o(D,{shrink:!0,children:"Servicio Homologado"}),o(I,{...t,styles:$,menuPosition:"fixed",name:"codigoProductoSin",placeholder:"Seleccione Servicio para homolgación",value:t.value||null,onChange:u=>{t.onChange(u)},options:K,getOptionValue:u=>u.codigoProducto,getOptionLabel:u=>`${u.codigoProducto} - ${u.descripcionProducto}`}),o(E,{children:(n=d.codigoProductoSin)==null?void 0:n.message})]})}})}),o(g,{item:!0,lg:8,md:12,xs:12,children:o(S,{control:e,name:"nombre",render:({field:t})=>{var n;return o(L,{name:"nombre",label:"Nombre Servicio",value:t.value,onChange:t.onChange,onBlur:()=>{const u=t.value,v=b(u);l(v),t.onBlur()},error:!!d.nombre,helperText:(n=d.nombre)==null?void 0:n.message})}})}),o(g,{item:!0,lg:4,md:4,xs:12,sm:6,children:o(S,{control:e,name:"codigoProducto",render:({field:t})=>{var n;return o(L,{name:"codigoProducto",label:"Código Servicio (SKU)",value:t.value,onChange:u=>{const v=u.target.value.toUpperCase();/^[A-Z0-9-]*$/.test(v)&&(t.onChange(v),l(v))},onBlur:u=>{const v=u.target.value;/^[A-Z0-9-]*$/.test(v)&&(t.value=v.toUpperCase(),t.onBlur(),l(v.toUpperCase()))},error:!!d.codigoProducto||t.value!==void 0&&!/^[A-Z0-9-]*$/.test(t.value),helperText:(n=d.codigoProducto)==null?void 0:n.message})}})}),o(g,{item:!0,lg:12,md:12,xs:12,children:o(S,{name:"descripcion",control:e,render:({field:t})=>o(L,{name:"descripcion",label:"Descripcion",multiline:!0,minRows:3,maxRows:5,value:t.value,onChange:t.onChange,onBlur:t.onBlur})})})]})})})},Oo=T`
  query UNIDAD_MEDIDA {
    sinUnidadMedida {
      codigoClasificador
      descripcion
    }
  }
`,Io=async()=>{const r=new w("https://sandbox.isipass.net/api"),e=localStorage.getItem(B);return r.setHeader("authorization",`Bearer ${e}`),(await r.request(Oo)).sinUnidadMedida},Xo=r=>{const{form:{control:e,setValue:i,watch:s,formState:{errors:c}}}=r,{data:d}=k(["unidadesMedida"],()=>Io());return o(M,{title:"PRECIO",children:m(g,{container:!0,columnSpacing:3,rowSpacing:2,children:[o(g,{item:!0,lg:8,md:12,xs:12,children:o(S,{control:e,name:"codigoUnidadMedida",render:({field:a})=>{var h;return m(y,{fullWidth:!0,sx:{mb:1},error:!!c.codigoUnidadMedida,children:[o(D,{shrink:!0,children:"Unidad Medida"}),o(I,{...a,styles:$,menuPosition:"fixed",placeholder:"Seleccione la unidad de medida",value:a.value,onChange:async p=>{a.onChange(p),i("codigoUnidadMedida",p)},options:d,getOptionValue:p=>p.codigoClasificador.toString(),getOptionLabel:p=>`${p.codigoClasificador} - ${p.descripcion}`}),o(E,{children:(h=c.codigoUnidadMedida)==null?void 0:h.message})]})}})}),o(g,{item:!0,lg:4,md:4,xs:12,children:o(S,{control:e,name:"precio",render:({field:a})=>{var h;return m(y,{fullWidth:!0,error:!!c.precio,children:[o(D,{shrink:!0,children:"Precio"}),o(go,{...a,min:0,placeholder:"0.00",name:"precio",value:a.value,onFocus:oo,onChange:p=>{a.onChange(p)},onBlur:p=>{const l=parseFloat(p.target.value);isNaN(l)||i("precio",l)},formatter:(p,l)=>po(p,l,2)}),o(E,{children:(h=c.precio)==null?void 0:h.message})]})}})})]})})},Yo=r=>{const{form:{control:e,setValue:i,reset:s,getValues:c,watch:d,formState:{errors:a,isSubmitted:h,isSubmitSuccessful:p}}}=r,[l,b]=A.useState(!1),{data:f,refetch:x}=k(["productoProveedores",l],async()=>{const C={page:1,limit:1e3,reverse:!0},{docs:P}=await ho(C);return P});return o(M,{title:"Proveedor",children:m(g,{container:!0,spacing:1,children:[o(g,{item:!0,lg:12,md:12,xs:12,children:o(S,{control:e,name:"codigoProveedor",render:({field:C})=>m(y,{fullWidth:!0,children:[o(D,{shrink:!0,children:"Seleccione su proveedor"}),o(I,{...C,styles:$,menuPosition:"fixed",name:"codigoProveedor",placeholder:"Seleccione proveedor...",value:C.value,onChange:P=>{C.onChange(P)},options:f,isClearable:!0,getOptionValue:P=>P.codigo,getOptionLabel:P=>`${P.codigo} - ${P.nombre}`})]})})}),m(g,{item:!0,lg:12,md:12,xs:12,textAlign:"right",children:[o(U,{variant:"outlined",onClick:()=>b(!0),size:"small",children:"Nuevo Proveedor"}),o(mo,{id:"proveedorRegistroDialog",keepMounted:!1,open:l,onClose:C=>{C&&(i("codigoProveedor",C),x().then()),b(!1)}})]})]})})};export{Jo as P,Xo as a,Ko as b,Yo as c,Qo as d,Zo as e,Go as p};
