import{a as c,U as K,_ as Q,j as e,$ as _,a1 as W,P as g,F as S,Z as j,a0 as U,a_ as Z,Q as E,W as J,aG as X,aH as Y,aJ as ee,ab as oe,ay as z,aB as re}from"./@mui-94e45ada.js";import{r as t}from"./react-19ede8c0.js";import{S as te,B as ae}from"./Breadcrumb-c4cf427b.js";import{A as x,M as ie,a as se,b as ne,p as ce}from"./index-a032e14e.js";import{M as le}from"./material-react-table-1f8ebe78.js";import{A as de,S as me}from"./AuditIconButton-d761f0b1.js";import{S as pe,a as ue}from"./SimpleMenu-fe44c236.js";import{P as C,l as ge}from"./localization-3d90e8d6.js";import{s as I,a as D,b as F}from"./swal-6db6c20f.js";import{g as w,G as b}from"./graphql-request-396d023b.js";import{b as he,p as fe,c as ve,P as Pe,a as Ce}from"./ProveedorRegistroDialog-e75467b3.js";import{u as Se}from"./formik-bccae489.js";import{c as xe}from"./react-router-11fb21ef.js";import{e as we}from"./@tanstack-464f39f1.js";import"./react-is-e5978b8b.js";import"./@emotion-01c0502c.js";import"./hoist-non-react-statics-6e7e3bdb.js";import"./@babel-41a3dc83.js";import"./stylis-79144faa.js";import"./react-transition-group-07c33d75.js";import"./react-dom-308b05ff.js";import"./scheduler-765c72db.js";import"./@popperjs-f3391c26.js";import"./jss-4560bbb1.js";import"./is-in-browser-9e40da8a.js";import"./jss-plugin-rule-value-function-275843d2.js";import"./jss-plugin-global-96037998.js";import"./jss-plugin-nested-279c4525.js";import"./jss-plugin-camel-case-92f9f32c.js";import"./hyphenate-style-name-80972348.js";import"./jss-plugin-default-unit-80d6b696.js";import"./jss-plugin-vendor-prefixer-711b305d.js";import"./css-vendor-f41dfb6e.js";import"./jss-plugin-props-sort-0c9fca2f.js";import"./react-router-dom-c0e9fbdc.js";import"./@remix-run-d753ad9e.js";import"./rc-input-number-5ce3f958.js";import"./classnames-e62508ea.js";import"./rc-util-f84322a6.js";import"./@rc-component-9042d6d8.js";/* empty css                     */import"./react-toastify-ac6b7c37.js";import"./clsx-1229b3e0.js";import"./react-datepicker-b19bab85.js";import"./date-fns-66b136a8.js";import"./react-onclickoutside-a7243ba6.js";import"./react-popper-4d77a87f.js";import"./warning-4834017b.js";import"./react-redux-0edfc849.js";import"./use-sync-external-store-b3a8aa83.js";import"./lodash-c8b5ff2a.js";import"./jwt-decode-9c18df67.js";import"./nanoid-bef4f1f3.js";import"./@reduxjs-e99b2c47.js";import"./immer-41fd5235.js";import"./redux-5bd193e3.js";import"./redux-thunk-ef899f4c.js";import"./form-data-c8368213.js";import"./extract-files-b993d67a.js";import"./graphql-9eaaa955.js";import"./cross-fetch-ff4a750f.js";import"./highlight-words-42d92bcd.js";import"./sweetalert2-b5adf0ab.js";import"./yup-861a4b8a.js";import"./property-expr-38205fa5.js";import"./tiny-case-d0726479.js";import"./toposort-85f95ecf.js";import"./yup-locales-e98f4908.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-6dbc5b30.js";import"./tiny-warning-c932d744.js";const be=w`
  mutation PROVEEDOR_ELIMINAR($codigoProveedor: [String]!) {
    proveedorEliminar(codigoProveedor: $codigoProveedor)
  }
`,ye=async a=>{const i=new b("https://sandbox.isipass.net/api"),o=localStorage.getItem(x);return i.setHeader("authorization",`Bearer ${o}`),(await i.request(be,{codigoProveedor:a})).proveedorEliminar},Ae=w`
  query PROVEEDOR($codigoProveedor: String!) {
    proveedor(codigoProveedor: $codigoProveedor) {
      codigo
      nombre
      direccion
      ciudad
      contacto
      correo
      telefono
    }
  }
`,Re=async a=>{const i=new b("https://sandbox.isipass.net/api"),o=localStorage.getItem(x);return i.setHeader("authorization",`Bearer ${o}`),(await i.request(Ae,{codigoProveedor:a})).proveedor},Ee=w`
  mutation PROVEEDOR_ACTUALIZACION($codigo: ID!, $input: ProveedorActualizarInput!) {
    proveedorActualizar(codigo: $codigo, input: $input) {
      ciudad
      contacto
      correo
      direccion
      nombre
      telefono
    }
  }
`,ze=async(a,i)=>{try{const o=new b("https://sandbox.isipass.net/api"),d=localStorage.getItem(x);return o.setHeader("authorization",`Bearer ${d}`),(await o.request(Ee,{codigo:a,input:i})).proveedorActualizar}catch(o){throw new ie(o)}},Ie=a=>{const{onClose:i,open:o,...d}=a,l=Se({initialValues:he,validationSchema:fe,onSubmit:async p=>{const{codigo:n,...f}=p;await I({preConfirm:()=>ze(n||"",f).catch(s=>(D(s),!1)),text:"Confirma que desea actualizar el proveedor?"}).then(s=>{s.isConfirmed&&(F(),i(s.value))})}}),h=()=>{i()};return t.useEffect(()=>{o&&(async()=>{try{const n=await Re(a.codigo);l.setValues(n)}catch(n){console.log(n)}})()},[o]),c(K,{sx:{"& .MuiDialog-paper":{width:"100%",maxHeight:500}},maxWidth:"sm",open:o,...d,children:[c(Q,{children:["Editar Proveedor ",a.codigo]}),e(_,{dividers:!0,children:e(ve,{formik:l})}),c(W,{children:[e(g,{autoFocus:!0,color:"error",size:"small",variant:"contained",onClick:h,children:"Cancelar"}),e(g,{onClick:l.submitForm,size:"small",style:{marginRight:25},variant:"contained",disabled:!l.isValid,children:"Actualizar Proveedor"})]})]})},De=[{accessorKey:"codigo",header:"Código"},{accessorKey:"nombre",header:"Proveedor"},{accessorKey:"direccion",header:"Dirección"},{accessorKey:"ciudad",header:"Ciudad"},{accessorKey:"contacto",header:"Contacto"},{accessorKey:"correo",header:"Correo Electrónico"},{accessorKey:"telefono",header:"Teléfono"},{accessorFn:a=>e(oe,{size:"small",label:a.state,color:"success"}),id:"state",header:"Estado"}],Fe=a=>{xe();const[i,o]=t.useState(null),[d,l]=t.useState(!1),[h,p]=t.useState(!1),[n,f]=t.useState([]),[s,M]=t.useState({pageIndex:C.page,pageSize:C.limit}),[T,k]=t.useState(0),[B,Me]=t.useState(!1),[v,O]=t.useState([]);t.useState("");const[$,y]=t.useState({}),[Te,A]=t.useState(!1),q=async()=>{A(!0);try{await u()}catch(r){console.error("Error al recargar los datos:",r)}A(!1)},{data:L,isError:R,isLoading:N,status:ke,refetch:u}=we(["proveedoresListado",n,s.pageIndex,s.pageSize,v],async()=>{const r=se(n),P={...C,page:s.pageIndex+1,limit:s.pageSize,reverse:v.length<=0,query:r},{pageInfo:m,docs:H}=await Ce(P);return k(m.totalDocs),H},{refetchOnWindowFocus:!0,keepPreviousData:!0}),V=t.useMemo(()=>De,[]),G=async r=>{const P=r.map(m=>m.original.codigo);await I({text:"Confirma que desea eliminar los registros seleccionados, esta operación no se podra revertir",preConfirm:()=>ye(P).catch(m=>(D(m),!1))}).then(m=>{m.isConfirmed&&(F(),y({}),u())})};return c(S,{children:[e(j,{elevation:0,variant:"elevation",square:!0,sx:{mb:2,p:.5,bgcolor:"#FAFAFA"},className:"asideSidebarFixed",children:e(U,{direction:{xs:"column",sm:"row"},style:{marginTop:2},spacing:{xs:1,sm:1,md:1,xl:1},justifyContent:"flex-end",children:c(g,{size:"small",variant:"contained",onClick:()=>l(!0),startIcon:e(Z,{}),color:"success",children:[" ","Nuevo Proveedor"]})})}),e(E,{sx:{mb:2,m:"1rem"},children:e(le,{columns:V,data:L??[],initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,muiToolbarAlertBannerProps:R?{color:"error",children:"Error loading data"}:void 0,onColumnFiltersChange:f,onPaginationChange:M,onSortingChange:O,enableDensityToggle:!1,enableGlobalFilter:!1,rowCount:T,localization:ge,state:{columnFilters:n,isLoading:N,pagination:s,showAlertBanner:R,showProgressBars:B,density:"compact",sorting:v,rowSelection:$},muiSearchTextFieldProps:{variant:"outlined",placeholder:"Busqueda",InputLabelProps:{shrink:!0},size:"small"},enableRowActions:!0,positionActionsColumn:"first",renderRowActions:({row:r})=>c("div",{style:{display:"flex",flexWrap:"nowrap",gap:"0.5rem",width:100},children:[e(pe,{menuButton:e(S,{children:e(J,{"aria-label":"delete",children:e(X,{})})}),children:c(ue,{onClick:()=>{o(r.original.codigo),p(!0)},children:[e(Y,{})," Modificar"]})}),e(de,{row:r.original})]}),muiTableHeadCellFilterTextFieldProps:{sx:{m:"0.5rem 0",width:"95%"},variant:"outlined",size:"small"},enableRowSelection:!0,onRowSelectionChange:y,displayColumnDefOptions:{"mrt-row-actions":{muiTableHeadCellProps:{align:"center"},size:120}},renderTopToolbarCustomActions:({table:r})=>c(E,{sx:{display:"flex",gap:"1rem",p:"0.5rem",flexWrap:"wrap"},children:[e(me,{refetch:q,sx:{flexGrow:1}}),e(g,{color:"error",onClick:()=>G(r.getSelectedRowModel().flatRows),startIcon:e(ee,{}),variant:"contained",size:"small",disabled:r.getSelectedRowModel().flatRows.length===0,sx:{height:"28px",top:"0.5rem"},children:"Eliminar"})]})})}),e(Pe,{id:"proveedorRegistroDialog",keepMounted:!1,open:d,onClose:r=>{r&&u().then(),l(!1)}}),e(Ie,{keepMounted:!1,open:h,codigo:i||"",onClose:r=>{r&&u().then(),o(null),p(!1)}})]})},Yo=()=>(t.useContext(ne),e(S,{children:c(te,{children:[e("div",{className:"breadcrumb",children:e(ae,{routeSegments:[{name:"Servicios",path:ce.gestion},{name:"Proveedores"}]})}),e(z,{container:!0,spacing:2,children:e(z,{item:!0,lg:12,md:12,xs:12,children:e(Fe,{})})}),e(re,{py:"12px"})]})}));export{Yo as default};
