import{d as w,_ as ne,p as We,q as F,j as Ae}from"./@babel-41a3dc83.js";import{r as t}from"./react-19ede8c0.js";import{r as ae}from"./classnames-e62508ea.js";import{u as je,w as Ye,a as Ee,b as Z,c as ze,K as L}from"./rc-util-f84322a6.js";import{n as he,t as Re,g as S,a as we,v as Ge,b as ee}from"./@rc-component-9042d6d8.js";var Je=200,Qe=600;function Xe(e){var c=e.prefixCls,o=e.upNode,y=e.downNode,d=e.upDisabled,v=e.downDisabled,p=e.onStep,f=t.useRef(),m=t.useRef();m.current=p;var g=function(R,_){R.preventDefault(),m.current(_);function O(){m.current(_),f.current=setTimeout(O,Je)}f.current=setTimeout(O,Qe)},s=function(){clearTimeout(f.current)};t.useEffect(function(){return s},[]);var N=je();if(N)return null;var l="".concat(c,"-handler"),E=ae(l,"".concat(l,"-up"),w({},"".concat(l,"-up-disabled"),d)),x=ae(l,"".concat(l,"-down"),w({},"".concat(l,"-down-disabled"),v)),q={unselectable:"on",role:"button",onMouseUp:s,onMouseLeave:s};return t.createElement("div",{className:"".concat(l,"-wrap")},t.createElement("span",ne({},q,{onMouseDown:function(R){g(R,!0)},"aria-label":"Increase Value","aria-disabled":d,className:E}),o||t.createElement("span",{unselectable:"on",className:"".concat(c,"-handler-up-inner")})),t.createElement("span",ne({},q,{onMouseDown:function(R){g(R,!1)},"aria-label":"Decrease Value","aria-disabled":v,className:x}),y||t.createElement("span",{unselectable:"on",className:"".concat(c,"-handler-down-inner")})))}function ye(e){var c=typeof e=="number"?he(e):Re(e).fullStr,o=c.includes(".");return o?Re(c.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}function Ze(e,c){var o=t.useRef(null);function y(){try{var v=e.selectionStart,p=e.selectionEnd,f=e.value,m=f.substring(0,v),g=f.substring(p);o.current={start:v,end:p,value:f,beforeTxt:m,afterTxt:g}}catch{}}function d(){if(e&&o.current&&c)try{var v=e.value,p=o.current,f=p.beforeTxt,m=p.afterTxt,g=p.start,s=v.length;if(v.endsWith(m))s=v.length-o.current.afterTxt.length;else if(v.startsWith(f))s=f.length;else{var N=f[g-1],l=v.indexOf(N,g-1);l!==-1&&(s=l+1)}e.setSelectionRange(s,s)}catch(E){Ye(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(E.message))}}return[y,d]}const en=function(){var e=t.useRef(0),c=function(){Ee.cancel(e.current)};return t.useEffect(function(){return c},[]),function(o){c(),e.current=Ee(function(){o()})}};var nn=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","controls","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep"],Ce=function(c,o){return c||o.isEmpty()?o.toString():o.toNumber()},De=function(c){var o=S(c);return o.isInvalidate()?null:o},an=t.forwardRef(function(e,c){var o,y=e.prefixCls,d=y===void 0?"rc-input-number":y,v=e.className,p=e.style,f=e.min,m=e.max,g=e.step,s=g===void 0?1:g,N=e.defaultValue,l=e.value,E=e.disabled,x=e.readOnly,q=e.upHandler,M=e.downHandler,R=e.keyboard,_=e.controls,O=_===void 0?!0:_,re=e.stringMode,k=e.parser,U=e.formatter,C=e.precision,D=e.decimalSeparator,W=e.onChange,A=e.onInput,j=e.onPressEnter,Y=e.onStep,Ve=We(e,nn),te="".concat(d,"-input"),B=t.useRef(null),xe=t.useState(!1),ue=F(xe,2),oe=ue[0],ie=ue[1],I=t.useRef(!1),K=t.useRef(!1),P=t.useRef(!1),Me=t.useState(function(){return S(l??N)}),le=F(Me,2),i=le[0],se=le[1];function _e(a){l===void 0&&se(a)}var z=t.useCallback(function(a,n){if(!n)return C>=0?C:Math.max(we(a),we(s))},[C,s]),G=t.useCallback(function(a){var n=String(a);if(k)return k(n);var u=n;return D&&(u=u.replace(D,".")),u.replace(/[^\w.-]+/g,"")},[k,D]),ce=t.useRef(""),fe=t.useCallback(function(a,n){if(U)return U(a,{userTyping:n,input:String(ce.current)});var u=typeof a=="number"?he(a):a;if(!n){var r=z(u,n);if(Ge(u)&&(D||r>=0)){var b=D||".";u=ee(u,b,r)}}return u},[U,z,D]),Ue=t.useState(function(){var a=N??l;return i.isInvalidate()&&["string","number"].includes(Ae(a))?Number.isNaN(a)?"":a:fe(i.toString(),!1)}),de=F(Ue,2),$=de[0],ve=de[1];ce.current=$;function T(a,n){ve(fe(a.isInvalidate()?a.toString(!1):a.toString(!n),n))}var h=t.useMemo(function(){return De(m)},[m,C]),V=t.useMemo(function(){return De(f)},[f,C]),me=t.useMemo(function(){return!h||!i||i.isInvalidate()?!1:h.lessEquals(i)},[h,i]),pe=t.useMemo(function(){return!V||!i||i.isInvalidate()?!1:i.lessEquals(V)},[V,i]),Ke=Ze(B.current,oe),ge=F(Ke,2),Pe=ge[0],$e=ge[1],be=function(n){return h&&!n.lessEquals(h)?h:V&&!V.lessEquals(n)?V:null},J=function(n){return!be(n)},Q=function(n,u){var r=n,b=J(r)||r.isEmpty();if(!r.isEmpty()&&!u&&(r=be(r)||r,b=!0),!x&&!E&&b){var H=r.toString(),X=z(H,u);return X>=0&&(r=S(ee(H,".",X)),J(r)||(r=S(ee(H,".",X,!0)))),r.equals(i)||(_e(r),W==null||W(r.isEmpty()?null:Ce(re,r)),l===void 0&&T(r,u)),r}return i},Te=en(),Se=function a(n){if(Pe(),ve(n),!K.current){var u=G(n),r=S(u);r.isNaN()||Q(r,!0)}A==null||A(n),Te(function(){var b=n;k||(b=n.replace(/ã€‚/g,".")),b!==n&&a(b)})},He=function(){K.current=!0},qe=function(){K.current=!1,Se(B.current.value)},Oe=function(n){Se(n.target.value)},Ne=function(n){var u;if(!(n&&me||!n&&pe)){I.current=!1;var r=S(P.current?ye(s):s);n||(r=r.negate());var b=(i||S(0)).add(r.toString()),H=Q(b,!1);Y==null||Y(Ce(re,H),{offset:P.current?ye(s):s,type:n?"up":"down"}),(u=B.current)===null||u===void 0||u.focus()}},Ie=function(n){var u=S(G($)),r=u;u.isNaN()?r=i:r=Q(u,n),l!==void 0?T(i,!1):r.isNaN()||T(r,!1)},ke=function(){I.current=!0},Be=function(n){var u=n.which,r=n.shiftKey;I.current=!0,r?P.current=!0:P.current=!1,u===L.ENTER&&(K.current||(I.current=!1),Ie(!1),j==null||j(n)),R!==!1&&!K.current&&[L.UP,L.DOWN].includes(u)&&(Ne(L.UP===u),n.preventDefault())},Fe=function(){I.current=!1,P.current=!1},Le=function(){Ie(!1),ie(!1),I.current=!1};return Z(function(){i.isInvalidate()||T(i,!1)},[C]),Z(function(){var a=S(l);se(a);var n=S(G($));(!a.equals(n)||!I.current||U)&&T(a,I.current)},[l]),Z(function(){U&&$e()},[$]),t.createElement("div",{className:ae(d,v,(o={},w(o,"".concat(d,"-focused"),oe),w(o,"".concat(d,"-disabled"),E),w(o,"".concat(d,"-readonly"),x),w(o,"".concat(d,"-not-a-number"),i.isNaN()),w(o,"".concat(d,"-out-of-range"),!i.isInvalidate()&&!J(i)),o)),style:p,onFocus:function(){ie(!0)},onBlur:Le,onKeyDown:Be,onKeyUp:Fe,onCompositionStart:He,onCompositionEnd:qe,onBeforeInput:ke},O&&t.createElement(Xe,{prefixCls:d,upNode:q,downNode:M,upDisabled:me,downDisabled:pe,onStep:Ne}),t.createElement("div",{className:"".concat(te,"-wrap")},t.createElement("input",ne({autoComplete:"off",role:"spinbutton","aria-valuemin":f,"aria-valuemax":m,"aria-valuenow":i.isInvalidate()?null:i.toString(),step:s},Ve,{ref:ze(B,c),className:te,value:$,onChange:Oe,disabled:E,readOnly:x}))))});an.displayName="InputNumber";export{an as I};
